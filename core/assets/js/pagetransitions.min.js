var PageTransitions = (function() {

    var $main = $( '#pt-main' ),
        $pages = $main.children( 'div.pt-page' ),
        $iterate = $( '.goto' ),
        animcursor = 1,
        pagesCount = $pages.length,
        isAnimating = false,
        endCurrPage = false,
        endNextPage = false,
        // animation end event name
        animEndEventName = "animationend",
        // support css animations
        support = true;


    function init() {

        $pages.each( function() {
            var $page = $( this );
            var i = 0;
            $page.data( 'originalClassList', $page.attr( 'class' ) );
            if($page.hasClass("first-page")){

                $page.addClass("pt-page-current");
            }
        } );




        $iterate.on( 'click', function() {
            if( isAnimating ) {
                return false;
            }

            nextPage( $(this) );
        } );

    }

    function nextPage(scope ) {
        //var animation = (options.animation) ? options.animation : options;

        if( isAnimating ) {
            return false;
        }

        isAnimating = true;

        // var $currPage = $pages.eq( current );
        var $currPage = $(".pt-page-current");

        var animation = $(scope).data("animation");




        // var $nextPage = $pages.eq( current ).addClass( 'pt-page-current' ),
        var $nextPage = $("#page-"+ $(scope).data("goto")),
            outClass = '', inClass = '';
            $nextPage.addClass( 'pt-page-current' );

        // change toppar

        if ( $( "#topbar-"+$(scope).data("goto") ).length ) {
            $(".topbar").removeClass("topbar-current");
            $( "#topbar-"+$(scope).data("goto") ).addClass("topbar-current");
        }


        if ( $( "#tabbar-"+$(scope).data("goto") ).length ) {
            $(".tabbar").removeClass("tabbar-current");
            $( "#tabbar-"+$(scope).data("goto") ).addClass("tabbar-current");

            if($( "#tabbar-"+$(scope).data("goto") ).hasClass("hide")){
                $("#tabbarContainer").addClass("hide");
            } else{
                $("#tabbarContainer").removeClass("hide");
            }
        }



        switch( animation ) {

            case "moveInFromRight":
                outClass = 'pt-page-moveToLeft';
                inClass = 'pt-page-moveFromRight';
                break;
            case "moveInFromLeft":
                outClass = 'pt-page-moveToRight';
                inClass = 'pt-page-moveFromLeft';
                break;
            case "moveInFromRightNoTabbar":
                outClass = 'pt-page-moveToLeft';
                inClass = 'pt-page-moveFromRight';
                $("#tabbarContainer").addClass("hide");
                break;
            case "moveInFromBottomNoTabbar":
                outClass = 'pt-page-moveToTop';
                inClass = 'pt-page-moveFromBottom';
                $("#tabbarContainer").addClass("hide");
                break;
            case "moveOutFromRight":
                outClass = 'pt-page-moveToRight';
                inClass = 'pt-page-moveFromLeft';
                break;
            case "moveOutFromRightNoTabbar":
                outClass = 'pt-page-moveToRight';
                inClass = 'pt-page-moveFromLeft';
                $("#tabbarContainer").addClass("hide");
                break;
            case "moveOutFromRightAddTabbar":
                outClass = 'pt-page-moveToRight';
                inClass = 'pt-page-moveFromLeft';
                $("#tabbarContainer").removeClass("hide");
                break;
            case "moveOutFromTopAddTabbar":
                outClass = 'pt-page-moveToBottomFade  pt-page-ontop';
                inClass = 'pt-page-scaleUp';
                $("#tabbarContainer").removeClass("hide");
                break;
            case "moveInFromBottom":
                outClass = 'pt-page-moveToTop';
                inClass = 'pt-page-moveFromBottom pt-page-ontop';
                break;
            case "moveInFromTop":
                outClass = 'pt-page-moveToBottom';
                inClass = 'pt-page-moveFromTop pt-page-ontop';
                break;
            case "moveCamInFromBottom":
                outClass = 'pt-page-moveToTop';
                inClass = 'pt-page-moveFromBottom pt-page-ontop';
                $("#tabbarContainer").addClass("hide");
                $nextPage.data("topbaraction", 'hide');
                break;
            case "moveOutFromTop":
                outClass = 'pt-page-moveToBottomFade  pt-page-ontop';
                inClass = 'pt-page-scaleUp';
                break;
            case "moveOutFromTopNoTabbar":
                outClass = 'pt-page-moveToBottomFade  pt-page-ontop';
                inClass = 'pt-page-scaleUp';
                $("#tabbarContainer").addClass("hide");
                break;
            case "moveCamOutFromTop":
                outClass = 'pt-page-moveToBottomFade  pt-page-ontop';
                inClass = 'pt-page-scaleUp';
                $(".topbarContainer").removeClass("hide");
                $("#tabbarContainer").removeClass("hide");
                break;case "moveOutFromTop2":
                outClass = 'pt-page-moveToBottom';
                inClass = 'pt-page-moveFromTop';
                break;
            case "moveOutToRight":
                outClass = 'pt-page-moveToRightFade';
                inClass = 'pt-page-moveFromLeftFade';
                break;

        }

        $currPage.addClass( outClass ).on( animEndEventName, function() {
            $currPage.off( animEndEventName );
            endCurrPage = true;
            if( endNextPage ) {
                onEndAnimation( $currPage, $nextPage );
            }
        } );

        $nextPage.addClass( inClass ).on( animEndEventName, function() {
            $nextPage.off( animEndEventName );
            endNextPage = true;
            if( endCurrPage ) {
                onEndAnimation( $currPage, $nextPage );
            }
        } );

        if( !support ) {
            onEndAnimation( $currPage, $nextPage );
        }

    }

    function onEndAnimation( $outpage, $inpage ) {
        endCurrPage = false;
        endNextPage = false;
        resetPage( $outpage, $inpage );
        isAnimating = false;

    }

    function resetPage( $outpage, $inpage ) {
        $outpage.attr( 'class', $outpage.data( 'originalClassList' ) );
        $inpage.attr( 'class', $inpage.data( 'originalClassList' ) + ' pt-page-current' );
        switch($inpage.data("topbaraction")){
            case 'hide':
                $(".topbarContainer").addClass("hide");
                break;
            case 'show':
                $(".topbarContainer").removeClass("hide");
                break;
        }
    }

    init();

    return {
        init : init,
        nextPage : nextPage,
    };

})();